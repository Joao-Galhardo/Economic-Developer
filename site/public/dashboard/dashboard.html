<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>

    <link rel="stylesheet" href="../css/stylePerfil/stylePerfil.css">
    <link rel="stylesheet" href="../css/stylePerfil/styleDashboad.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="../js/sessao.js"></script>
    <script src="../js/botaoInvestir.js"></script>
    <script src="../js/metaDashboard.js"></script>


</head>

<body onload="validarSessao()">
    <header class="rodape">
        <img class="foto" src="./imagens/fotoMF.jpg" alt="Foto do Perfil">
        <h1 class="title" id="b_usuario"></h1>
        <a class="botao-ancora" href="./dashboard.html">Início</a>
        <a class="botao-ancora" href="./simulador.html">Simulador Financeiro</a>
        <a class="botao-ancora" href="./cursos.html">Cursos</a>
        <a class="botao-ancora" href="./metas.html">Metas Financeiras</a>
        <a class="botao-ancora" href="./conversor.html">Conversor de Moedas</a>
        <a class="botao-ancora" onclick="limparSessao()">Sair</a>
    </header>
    <main>
        <div class="superior-inicio">
            <h1 class="title-inicio">Minhas Metas</h1>
            <div id="div_funcaoMeta" class="divisao-metas">
                <div class="metas">
                    <h2 class="title-metas">Meta 1</h1>
                        <div class="rotulos-metas">
                            <div class="descricao-metas">
                                <h3 class="alcançado">Valor Atual</h3>
                                <h3 class="alcançado">% Alcançada</h3>
                            </div>
                            <div class="valores-metas">
                                <h3>R$ <span></span></h3>
                                <h3><span></span> %</h3>
                            </div>
                        </div>
                        <div class="botoes-metas">
                            <button class="btn-excluir">Excluir</button>
                            <button class="btn-investir" id="btn_investir" onclick="abrirInvestir()">Investir</button>
                        </div>
                        <div class="investir-metas" id="div_investir">
                            <div class="rotulos-investimentos">
                                <label class="rotulo">Valor do investimento</label>
                                <label class="rotulo" style="align-self: flex-end;">Data</label>
                            </div>
                            <div class="rotulos-investimentos">
                                <input type="number" id="valorInvestido_input">
                                <input type="date" id="dtInvestimento_input">
                            </div>
                        </div>
                        <button id="btn_salvar" class="btn-salvar" onclick="investir()">Salvar</button>
                </div>
            </div>
        </div>
        <div class="inferior-inicio">
            <div class="espaço-grafico">
                <h1 class="title-canva">Quanto ja consegui</h1>
                <div class="grafico">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div class="espaço-grafico">
                <h1 class="title-canva">Investimentos por mês</h1>
                <div class="grafico">
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>
    </main>
</body>

</html>


<script>

    const graficoPorcentagem = document.getElementById('myChart');

    new Chart(graficoPorcentagem, {
        type: 'pie',
        data: {
            labels: ['Blue', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19,],
                backgroundColor: [
                    'rgb(242, 149, 89)',
                    'rgb(0, 7, 45)',
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const graficoLinha = document.getElementById('myChart2');

    new Chart(graficoLinha, {
        type: 'line',
        data: {
            labels: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            datasets: [{
                label: 'Investimento por Mês',
                data: [12, 19, 3, 5, 2, 3, 6, 8, 9, 10, 20, 5],
                backgroundColor: [
                    'rgb(15, 82, 87)'
                ],
                borderColor: 'rgb(15, 82, 87)',
                borderWidth: 3
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    function investir() {

        var valorInvestido = Number(valorInvestido_input.value);
        var dtInvestimento = dtInvestimento_input.value;
        var idMeta = sessionStorage.ID_META
        var erros = 0;

        

    
    fetch("/dashboard/investir", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      valorInvestidoServer: valorInvestido,
      dtInvestimentoServer: dtInvestimento,
      
    }),
  })
    .then(function (resposta) {
      console.log("resposta: ", resposta);

      if (resposta.ok) { 
      } else {
        throw "Houve um erro ao tentar realizar o investimento!";
      }
    })
    .catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      
    });

  return false;
}
  
function listar() {
    fetch("/dashboard/listar", {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((metas) => {
        console.log(metas)
          metas.forEach((empresa) => {
            listaMetas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
          });
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

</script>